<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=description content="The OD matrix is a very useful tool to analyze the supply and demand"><meta property="og:title" content="The Origin-Destination Matrix"><meta property="og:type" content="article"><meta property="og:url" content="/road-freight/basics/origin-destination-matrix/"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="The Flow"><meta property="og:description" content="The OD matrix is a very useful tool to analyze the supply and demand"><meta name=og:type content="article"><link rel=canonical content="/road-freight/basics/origin-destination-matrix/"><meta name=generator content="Hugo 0.69.2"><title>The Flow | Basics | The Origin-Destination Matrix</title><link rel=stylesheet href=/css/style.4efe7c2c35da456c0450ba0926f22f22a5d62ea5443e1071a41ad8b48d07275a.css integrity="sha256-Tv58LDXaRWwEULoJJvIvIqXWLqVEPhBxpBrYtI0HJ1o="><link href=https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.css integrity="sha256-XUbSD3m+xLW27W/mp9kMn+fI9AU2MoBkiMMSVVYWI+o=" crossorigin=anonymous><style>ul.contributors{list-style-type:none}ul.contributors:after{content:'';width:100%}.contributors li{text-align:center;display:inline-block;padding-bottom:20px;margin-left:10px;width:150px}.contributors li img{text-align:center;width:100px;border-radius:50%}</style><script src=https://code.jquery.com/jquery-3.4.1.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],tags:'ams'},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js integrity="sha256-KzZiKy0DWYsnwMF+X1DvQngQ2/FxF7MF3Ff72XcpuPs=" crossorigin=anonymous></script></head><body class=has-navbar-fixed-top><div class=page><nav class="navbar is-expanded is-white is-fixed-top has-shadow" role=navigation aria-label=dropdown-navigation><div class=navbar-brand><a class="navbar-item is-size-5 is-size-6-mobile has-text-weight-bold" href=/>The Flow</a><div class="navbar-item is-expanded is-hidden-touch" id=search-navbar-item><div class=dropdown id=search-dropdown><div class=dropdown-trigger><p class="control has-icons-left"><input class="input is-static" placeholder=Search id=search-bar>
<span class="icon is-medium is-left"><ion-icon src=/img/icons/search.svg></ion-icon></span></p></div><div class=dropdown-menu id=search-menu><div class=dropdown-content id=search-content></div></div></div></div><a role=button class="navbar-burger burger" aria-label=menu aria-expanded=false data-target=navbar-menu><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a></div><div class=navbar-menu id=navbar-menu><div class=navbar-end><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link is-arrowless" href=/road-freight><span>Road Freight</span>
<span class="icon has-text-primary"><ion-icon src=/img/icons/arrow-dropdown.svg></ion-icon></span></a><div class=navbar-dropdown><a class=navbar-item href=/road-freight/basics><span>Road Freight Basics</span></a></div></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link is-arrowless" href=/economics><span>Economics</span>
<span class="icon has-text-primary"><ion-icon src=/img/icons/arrow-dropdown.svg></ion-icon></span></a><div class=navbar-dropdown><a class=navbar-item href=/economics/microeconomics><span>Microeconomics</span></a>
<a class=navbar-item href=/economics/auction-theory/auction-theory-basics><span>Auction Theory</span></a></div></div><div class=navbar-item><div class=buttons><a class="button is-normal is-black" href=https://github.com/emptymalei/theflow target=_blank><span class=icon><ion-icon src=/img/icons/logo-github.svg></ion-icon></span></a><a class="button is-normal is-linkedin-blue" href=https://linkedin.in/in/leima137 target=_blank><span class=icon><ion-icon src=/img/icons/logo-linkedin.svg></ion-icon></span></a></div></div></div></div></nav><div class=dashboard><div class="dashboard-sidebar has-border-right is-hidden-touch"><nav class="nav is-sticky"><header class=nav-header><nav class="level is-size-5"><div class=level-left><div class=level-item><p class="nav-header-title has-text-weight-bold">Docs</p></div><div class=level-item><span class="icon has-text-primary"><ion-icon src=/img/icons/apps.svg></ion-icon></span></div></div></nav></header><div class="nav-container is-scrollable"><div class=nav-section><header class=nav-section-header><a href=/road-freight/>Road Freight ðŸšš</a></header></div><div class=nav-section><header class=nav-section-header><a href=/road-freight/basics/>Basics</a></header><ul class=nav-section-links><li><a href=/road-freight/basics/what-is-road-freight/>What is Road Freight</a></li><li><a href=/road-freight/basics/freight-modes/>Modes of Freight</a></li><li><a class=is-active href=/road-freight/basics/origin-destination-matrix/>The Origin-Destination Matrix</a></li></ul></div><div class=nav-section><header class=nav-section-header><a href=/road-freight/topics/>Topics in Road Freight</a></header><ul class=nav-section-links><li><a href=/road-freight/topics/road-speed-limits/>Speed Limits</a></li></ul></div></div></nav></div><div class=dashboard-main><section class="hero is-white is-normal"><div class=hero-head style=padding-left:1.5rem><div class=container><nav class="breadcrumb is-center has-succeeds-separator" aria-label=breadcrumbs><ul><li><a href=/>The Flow</a></li><li><a href=/road-freight/>Road Freight ðŸšš</a></li><li><a href=/road-freight/basics/>Basics</a></li><li class=is-active><a href=/road-freight/basics/origin-destination-matrix/>The Origin-Destination Matrix</a></li></ul></nav></div></div><div class=hero-body><div class=container><p class="title is-size-2 is-size-3-mobile has-text-dark has-text-weight-light is-spaced">The Origin-Destination Matrix</p><p class="subtitle is-size-3 is-size-4-mobile has-text-grey-dark">The OD matrix is a very useful tool to analyze the supply and demand</p><div class=tags><a class="tag is-primary is-small" href=/tags/Road%20Freight>#Road Freight</a>
<a class="tag is-primary is-small" href=/tags/Economics>#Economics</a></div></div></div></section><section class=section><div class=container><div class="content has-restricted-width has-bottom-padding"><p>In this section, we will be looking into the so-called origin-destination matrix, or the OD matrix. The OD matrix tells us the trip distribution between a pair of locations $(p, q)$. There are many representations of the OD matrix. It can be represented using a matrix, a network, or the generating process behind it.</p><div class="admonition is-info"><div class=columns><div class="column is-1"><span class="icon has-text-info"><ion-icon size=medium src=/img/icons/information-circle-outline.svg></ion-icon></span></div><div class=column><div class=content><p class="title is-size-4 is-size-5-mobile">Notations</p><p>In this page, we will use the following notations.</p><ol><li>$P$: a set of origins;</li><li>$p$: an element of $P$, i.e., an origin;</li><li>$Q$: a set of destinations;</li><li>$q$: an element of $Q$, i.e., a destination;</li><li>$o_p$: total flow out of the origin $p$;</li><li>$d_q$: total flow into destination $q$;</li><li>$g_{pq}$: flow between origin $p$ and destination $q$.</li><li>$\{g_{pq}\}$: the travel demand.</li></ol></div></div></div></div><h2 id=the-matrix>The Matrix</h2><p>The origin-destination matrix describes ${g_{pq}}$ for origin-destination pairs $pq\in P\bigotimes Q$.</p><p>We show an example using the international road freight data from Eurostats.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> The are many different representations of the origin-destination matrix. The data can be represented using tabular data. On the other hand, it is easier to interpret if we introduce some visualization elements. For example, we visualize the matrix using a heatmap where we color code the amount of goods transported in unit of million-tonne-kilometer.</p><figure><img src=../assets/origin-destination-matrix/europe-international-goods-matrix-plot.png alt="Visualization of goods loaded unloaded in Europe. The gray cells in the charts indicates missing data."><figcaption><p>Visualization of goods loaded unloaded in Europe. The gray cells in the charts indicates missing data.</p></figcaption></figure><p>Alternatively, we can visualize this matrix using networks.</p><figure><img src=../assets/origin-destination-matrix/europe-international-goods-network-vis.png alt="Visualization of goods loaded unloaded in Europe using networks. Some countries are less connected."><figcaption><p>Visualization of goods loaded unloaded in Europe using networks. Some countries are less connected.</p></figcaption></figure><p>There are other visualizations of networks such as arc plots and circle plots. In the end, visualizations are just some of the representations of the matrix. A much more powerful representation is a way to describe the generating process of the origin-destination matrix. For example, we could represent the underlying generating process with a function. The function itself, could as well be a neural network if desired.</p><h2 id=a-generating-process-behind-the-origin-destination-matrix>A Generating Process behind the Origin-Destination Matrix</h2><p>Simply describing the data is not so satisfying. What is more powerful is to find or construct a simple model to describe the underlying generating process so it can be used to find causalities and predict the future. One of such models is the gravity model.</p><p>The gravity model is a simple distribution model where we assume the distribution is proportional to the two masses: the flow out of the origin and the flow into the destination. In this section, we will follow A. Peterson to demonstrate the basic ideas of this model<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. The flow between origin $p$ and destination $q$ is assumed to be proportional to the multiplication of them, as the gravitational force between to massive objects,</p><p>$$
g_{pq} = k_{pq} o_p d_q f(\pi_{pq}),
$$</p><p>where $\pi_{pq}$ is the travel impedance. We have</p><p>$$
o_p = \sum_q g_{pq}
$$</p><p>and</p><p>$$
d_q = \sum_p g_{pq}.
$$</p><p>The deterrence function $f(\pi_{pq})$ can have many different forms as long as it captures the factors of friction:</p><ul><li>polynomial: $\pi_{pq}^{-\beta}$,</li><li>exponential: $e^{-\beta \pi_{pq}}$.</li></ul><p>The coefficient $k_{pq}$ is also taking care of the fact that the dependency on the masses $o_p$ and $d_q$ and the deterrence can be different for different lanes.</p><p>Given the fact that the total flow out of $p$ is</p><p>$$
o_p = \sum_q g_{pq} = o_p\sum_q k_{pq} d_q f(\pi_{pq}),
$$</p><p>we thus derive a simple identity</p><p>$$
\sum_q k_{pq} d_q f(\pi_{pq}) = 1.
$$</p><h2 id=modal-split>Modal Split</h2><p>The split of the loads between origin and destination can also be assigned to different modes, i.e., partitioning of the flow based on travel modes $g^k_{pq}$. In this section, we review a method called multinomial logit model introduced in A. Peterson (2007)<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. We use the probability of modes $p_k$ to describe the split, i.e., $g_{pqk} = g_{pq}p_k$.</p><p>To partition the flow, a utility function $u_k$ of each mode $k$ is introduced. The utility function considers:</p><ul><li>Some attributes denoted by $h$, $h$ can be walking time, transport time, etc. All the attributes form a set $H$ where $h\in H$;</li><li>Travel mode $k$;</li><li>The measured value of attribute $h$ for travel mode $k$: $x_{hk}$;</li><li>Weighting parameter $\alpha_h$.</li></ul><p>The utility function has two major parts. The part of utility that can be modeled</p><p>$$
v_k = \sum_h \alpha_h x_{hk},
$$</p><p>as well as a part from the random effects. The actual utility may have some random effects $\epsilon_k$,</p><p>$$
u_k = v_k + \epsilon_k.
$$</p><p>The multinomial logit model assumes the probability of the mode $k$ to be</p><p>$$
p_k = \frac{e^{\mu u_k}}{ \sum_k e^{\mu u_k} } = \frac{e^{\mu v_k} e^{\mu \epsilon_k}}{ \sum_k e^{\mu u_k} e^{\mu \epsilon_k} }.
$$</p><p>The non-linearity leads to some problems. Different combination of modes leads to contradictory results.<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> One solution to such problems is to come up with a fixed hierarchy model.</p><h2 id=references>References</h2><ol><li><a href=https://en.wikipedia.org/wiki/Trip_distribution>Trip distribution @ Wikipedia</a></li></ol><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://ec.europa.eu/eurostat/web/main/home>Eurostats</a> is a good place to find <a href=https://ec.europa.eu/eurostat/data/database>datasets about Europe</a>. For example, the provide a dataset on <a href="https://ec.europa.eu/eurostat/estat-navtree-portlet-prod/BulkDownloadListing?file=data/road_go_ia7lgtt.tsv.gz">goods loaded in reporting country</a> with <a href=https://ec.europa.eu/eurostat/cache/metadata/en/road_go_esms.htm>illustrations of the data here</a>. <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>Peterson, A. (2007). The Originâ€“Destination Matrix Estimation Problem â€” Analysis and Computations. In Journal of Scientific and Industrial Research (Vol. 67). <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></div></div></section><section class=section><div class=container><div class="pagination has-restricted-width"><a class="button is-primary" href=/road-freight/basics/freight-modes/><span class=icon><ion-icon src=/img/icons/arrow-back.svg></ion-icon></span><span><strong>Previous</strong>&nbsp;|&nbsp;Modes of Freight</span></a></div></div></section></div><div class="dashboard-toc is-hidden-touch"><div class="toc-container is-sticky"><nav class="level is-size-5"><div class=level-left><div class=level-item><p class=has-text-weight-bold>Content</p></div><div class=level-item><span class="icon has-text-primary"><ion-icon src=/img/icons/list.svg></ion-icon></span></div></div></nav><div class=toc></div></div></div></div><footer class=footer><section class="hero is-bold"><div class=hero-body><div class=container><div class="columns is-vcentered"><div class=column><p class="title is-size-3 is-size-4-mobile has-text-white-bis has-text-weight-light is-spaced">The Flow</p><p class="subtitle is-size-4 is-size-5-mobile has-text-light">Notes for data scientists in the logistics industry.</p><div class=buttons><a class="button is-small is-black is-inverted" href=https://github.com/emptymalei/theflow target=_blank><span class=icon><ion-icon src=/img/icons/logo-github.svg></ion-icon></span></a><a class="button is-small is-linkedin-blue is-inverted" href=https://linkedin.in/in/leima137 target=_blank><span class=icon><ion-icon src=/img/icons/logo-linkedin.svg></ion-icon></span></a></div><p class="has-text-weight-light has-text-grey-light">&copy; 2021 Lei Ma</p></div></div></div></div></section></footer></div><script src=/js/app.8aa12458222656d47218d0154d69257c4435211c645649b4c677859bc06fd46f.js integrity="sha256-iqEkWCImVtRyGNAVTWklfEQ1IRxkVkm0xneFm8Bv1G8="></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.4.5/fuse.min.js integrity="sha256-Yrh3VGzE4d9b4KANknPJAhfcKt9SgHTL0v/FrJFoPzw=" crossorigin=anonymous></script><script type=module src=https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@4.5.10-0/dist/ionicons/ionicons.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.10.0/tocbot.js integrity="sha256-4IG15rBugCIlZRpH7sSFc2AqT1+RAWLzMiv2rn2HMbM=" crossorigin=anonymous></script><script>tocbot.init({tocSelector:'.toc',contentSelector:'.content',headingSelector:'h1, h2, h3',hasInnerContainers:true,extraLinkClasses:'toc-page-link',listItemClass:'toc-page-item'});</script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js integrity="sha256-E4RlfxwyJVmkkk0szw7LYJxuPlp6evtPSBDlWHsYYL8=" crossorigin=anonymous></script><script>anchors.options={icon:'#'}
anchors.add('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6')</script><script>const numFound=(num,results,found)=>{return `<div class="dropdown-item has-text-weight-bold">
      ${num} ${results} ${found}
    </div>
    <span class="dropdown-divider"></span>`;}
const result=(url,title,section)=>{return `<a class="dropdown-item" href="${url}">
      <p class="has-text-grey is-tiny">
        ${section}
      </p>
      <p>
        ${title}
      </p>
    </a>`;}
$(()=>{const searchBar=$('#search-bar'),searchMenu=$('#search-menu'),searchContent=$('#search-content');const options={shouldSort:true,threshold:0.6,maxPatternLength:32,minMatchCharLength:2,keys:[{name:'title',weight:0.4},{name:'tags',weight:0.2},{name:'summary',weight:0.3,},{name:'body',weight:0.1}]}
fetch('\/index\.json').then((res)=>{return res.json();}).then((idx)=>{const fuse=new Fuse(idx,options);searchBar.on('focusin',()=>{searchBar.on('keyup',()=>{const term=searchBar.val().toLowerCase();if(term){const results=fuse.search(term);const numResults=results.length;if(numResults>0){searchMenu.show();searchContent.empty();var numAdded=0;const numTerm=(numResults==1)?'result':'results';const numItems=numFound(numResults,numTerm,'found');searchContent.append(numItems);results.forEach((res)=>{console.log(res.url);const item=result(res.url,res.title,res.section);searchContent.append(item);searchContent.show();});}}else{searchMenu.hide();}});});});});</script><script type=application/json class=js-hypothesis-config>{"openSidebar":false,"theme":"clean","enableExperimentalNewNoteButton":true}</script><script async src=https://hypothes.is/embed.js></script></body></html>